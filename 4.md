
#Python For Everybody
##4 - Using Databases with Python

###0) python version used

```python
import sys
print(sys.version)
```

```
## 2.7.10 (default, Oct 23 2015, 18:05:06) 
## [GCC 4.2.1 Compatible Apple LLVM 7.0.0 (clang-700.0.59.5)]
```

###1) object oriented python intro

```python
movies = list()
movie1={"Director" : "James Cameron", "Title" : "Avatar", "Release Date" : "18 December 2009", "Running Time" : "162 minutes", "Rating" : "PG-13"}
movies.append(movie1)
movie2={"Director" : "David Fincher", "Title" : "The Social Network", "Release Date" : "01 October 2010", "Running Time" : "120 minutes", "Rating" : "PG-13"}
movies.append(movie2)

keys = ["Title", "Director", "Rating", "Running Time"]
print movies
for item in movies:
    print "-------------------------"
    for key in keys:
        print key + ":", item[key] # because we expect the list of dictionary to contain values for the keys
print "-------------------------"
```

```
## [{'Director': 'James Cameron', 'Running Time': '162 minutes', 'Rating': 'PG-13', 'Release Date': '18 December 2009', 'Title': 'Avatar'}, {'Director': 'David Fincher', 'Running Time': '120 minutes', 'Rating': 'PG-13', 'Release Date': '01 October 2010', 'Title': 'The Social Network'}]
## -------------------------
## Title: Avatar
## Director: James Cameron
## Rating: PG-13
## Running Time: 162 minutes
## -------------------------
## Title: The Social Network
## Director: David Fincher
## Rating: PG-13
## Running Time: 120 minutes
## -------------------------
```

###2) simple python objects example

```python
class PartyAnimal:
    x = 0
    def party(self):
        self.x = self.x + 1
        print "So far", self.x
an = PartyAnimal() # instance with initial x attribute equaling 0
print "type:", type(an)
print "dir:", dir(an)
an.party() # increments x attribute by 1, prints it (1)
an.party() # "" (2)
an.party() # "" (3)
```

```
## type: <type 'instance'>
## dir: ['__doc__', '__module__', 'party', 'x']
## So far 1
## So far 2
## So far 3
```

###3) simple demonstration of object lifecycle1

```python
class PartyAnimal:
    x = 0
    def __init__(self): ## two underscores each side
        print "I am constructed"
    def party(self):
        self.x = self.x + 1
        print "So far", self.x
    def __del__(self): ## destructor
        print "I am destructed", self.x
an = PartyAnimal()
an.party()
an.party()
an.party()
```

```
## I am constructed
## So far 1
## So far 2
## So far 3
## I am destructed 3
```

###4) simple demonstration of object lifecycle2

```python
class PartyAnimal:
    x = 0
    name = ""
    def __init__(self,nam):
        self.name = nam
        print self.name, "constructed"
    def party(self):
        self.x = self.x + 1
        print self.name, "party count", self.x
s = PartyAnimal("Sally")
s.party()
j = PartyAnimal("Jim")
j.party()
s.party()
```

```
## Sally constructed
## Sally party count 1
## Jim constructed
## Jim party count 1
## Sally party count 2
```

###5) inheritance simple example

```python
class PartyAnimal:
    x = 0
    name = ""
    def __init__(self,nam):
        self.name = nam
        print self.name, "constructed"
    def party(self):
        self.x = self.x + 1
        print self.name, "party count", self.x
class FootballFan(PartyAnimal): # inherits all of the PartyAnimal class
    points = 0
    def touchdown(self):
        self.points = self.points + 7
        self.party() # inherited method from Parent class
        print self.name, "points", self.points
s = PartyAnimal("Sally")
s.party()
j = FootballFan("Jim") # inherits or extends Parent's attributes x,name
j.party()
j.touchdown()
```

```
## Sally constructed
## Sally party count 1
## Jim constructed
## Jim party count 1
## Jim party count 2
## Jim points 7
```

###6) email database demo example

```python
import sqlite3
conn = sqlite3.connect('emaildb.sqlite')
cur = conn.cursor()
cur.execute('''
DROP TABLE IF EXISTS Counts''')
cur.execute('''
CREATE TABLE Counts (email TEXT, count INTEGER)''')
fname = "mbox-short.txt"
if(len(fname)<1) : fname = "mbox-short.txt"
fh = open(fname)
for line in fh:
    if not line.startswith("From: ") : continue
    pieces = line.split()
    print "->",pieces,"<-"
    email = pieces[1]
    '''******************************************************
    ? is a placeholder -- that it is going to be something
    (email,) is a tuple (row) -- email gets substituted for ? 
    parameter substitution using ? is a safety measure
    *******************************************************'''
    cur.execute('SELECT count FROM Counts WHERE email = ?', (email, ))
    # if email matches the one in the database, increments count by 1
    try:
        count = cur.fetchone()[0]
        cur.execute('UPDATE Counts SET count=count+1 WHERE email = ?',
                    (email,))
    # if db has not seen the email yet, set the value of count as 1
    except:
        cur.execute('''INSERT INTO Counts (email, count)
                    VALUES (?,1)''',(email,))
    conn.commit()
    
# obtaining top 10 descending counts of emails
sqlstr = "SELECT email, count FROM Counts ORDER BY count DESC LIMIT 10"

for row in cur.execute(sqlstr) : # row is a tuple
    print str(row[0]), row[1] # str in case UTF-8
```

```
## -> ['From:', 'stephen.marquard@uct.ac.za'] <-
## -> ['From:', 'louis@media.berkeley.edu'] <-
## -> ['From:', 'zqian@umich.edu'] <-
## -> ['From:', 'rjlowe@iupui.edu'] <-
## -> ['From:', 'zqian@umich.edu'] <-
## -> ['From:', 'rjlowe@iupui.edu'] <-
## -> ['From:', 'cwen@iupui.edu'] <-
## -> ['From:', 'cwen@iupui.edu'] <-
## -> ['From:', 'gsilver@umich.edu'] <-
## -> ['From:', 'gsilver@umich.edu'] <-
## -> ['From:', 'zqian@umich.edu'] <-
## -> ['From:', 'gsilver@umich.edu'] <-
## -> ['From:', 'wagnermr@iupui.edu'] <-
## -> ['From:', 'zqian@umich.edu'] <-
## -> ['From:', 'antranig@caret.cam.ac.uk'] <-
## -> ['From:', 'gopal.ramasammycook@gmail.com'] <-
## -> ['From:', 'david.horwitz@uct.ac.za'] <-
## -> ['From:', 'david.horwitz@uct.ac.za'] <-
## -> ['From:', 'david.horwitz@uct.ac.za'] <-
## -> ['From:', 'david.horwitz@uct.ac.za'] <-
## -> ['From:', 'stephen.marquard@uct.ac.za'] <-
## -> ['From:', 'louis@media.berkeley.edu'] <-
## -> ['From:', 'louis@media.berkeley.edu'] <-
## -> ['From:', 'ray@media.berkeley.edu'] <-
## -> ['From:', 'cwen@iupui.edu'] <-
## -> ['From:', 'cwen@iupui.edu'] <-
## -> ['From:', 'cwen@iupui.edu'] <-
## cwen@iupui.edu 5
## zqian@umich.edu 4
## david.horwitz@uct.ac.za 4
## louis@media.berkeley.edu 3
## gsilver@umich.edu 3
## stephen.marquard@uct.ac.za 2
## rjlowe@iupui.edu 2
## wagnermr@iupui.edu 1
## antranig@caret.cam.ac.uk 1
## gopal.ramasammycook@gmail.com 1
```

###7) counting organization SQL assignment example

```python
## count by organization (domain name of email)
import re
import sqlite3
conn = sqlite3.connect('emaildb_assignment.sqlite')
cur = conn.cursor()
cur.execute('''
DROP TABLE IF EXISTS Counts''')
cur.execute('''
CREATE TABLE Counts (org TEXT, count INTEGER)''')
fname = "mbox.txt"
fh = open(fname)

for line in fh:
    if not line.startswith("From "): continue
    line = line.rstrip()
    #org = re.findall("@(\S+)\s*",line)[0]
    orglist = re.findall("@(\S+)\s*",line)
    if len(orglist) > 0 :
        org = orglist[0]
        cur.execute('SELECT count FROM Counts WHERE org = ?', (org, ))
    # if email matches the one in the dKatabase, increments count by 1
    try:
        count = cur.fetchone()[0]
        cur.execute('UPDATE Counts SET count=count+1 WHERE org = ?',
                    (org,))
    # if db has not seen the email yet, set the value of count as 1
    except:
        cur.execute('''INSERT INTO Counts (org, count)
                    VALUES (?,1)''',(org,))
conn.commit()

sqlstr = "SELECT org, count FROM Counts ORDER BY count DESC"

for row in cur.execute(sqlstr) : # row is a tuple
    print "->"+str(row[0])+"<-", row[1] # str in case UTF-8

```

```
## ->iupui.edu<- 536
## ->umich.edu<- 491
## ->indiana.edu<- 178
## ->caret.cam.ac.uk<- 157
## ->vt.edu<- 110
## ->uct.ac.za<- 96
## ->media.berkeley.edu<- 56
## ->ufp.pt<- 28
## ->gmail.com<- 25
## ->et.gatech.edu<- 17
## ->txstate.edu<- 17
## ->whitman.edu<- 17
## ->lancaster.ac.uk<- 14
## ->bu.edu<- 14
## ->stanford.edu<- 12
## ->unicon.net<- 9
## ->loi.nl<- 9
## ->rsmart.com<- 8
## ->ucdavis.edu<- 1
## ->fhda.edu<- 1
## ->utoronto.ca<- 1
```
